INFO : 2022-08-10 02:39:34,661 : cdc_append : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/config.yaml
INFO : 2022-08-10 02:39:34,663 : cdc_append : _context.py._get_spark_context: line(85) : Setting spark context
:: loading settings :: url = jar:file:/Users/shaunryan/opt/spark-3.2.1-bin-hadoop3.2/jars/ivy-2.5.0.jar!/org/apache/ivy/core/settings/ivysettings.xml
INFO : 2022-08-10 02:39:39,087 : cdc_append : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-10 02:39:39,091 : cdc_append : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-10 02:39:39,091 : cdc_append : _context.py.__init__: line(66) : Setting application context dataflow cdc_append
INFO : 2022-08-10 02:39:39,091 : cdc_append : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/cdc_append.yaml
INFO : 2022-08-10 02:39:39,104 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-10 02:39:39,104 : cdc_append : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl-patterns/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:39:39,109 : cdc_append : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=d30bab4f-06b1-474f-a8c9-fb538a8bb2a6
INFO : 2022-08-10 02:39:39,109 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-10 02:39:45,081 : cdc_append : _reader.py.create_or_alter_table: line(61) : Exception table already exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/exceptions/landing/exceptions _correlation_id=d30bab4f-06b1-474f-a8c9-fb538a8bb2a6
INFO : 2022-08-10 02:39:45,081 : cdc_append : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=d30bab4f-06b1-474f-a8c9-fb538a8bb2a6
INFO : 2022-08-10 02:39:45,365 : cdc_append : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=d30bab4f-06b1-474f-a8c9-fb538a8bb2a6
INFO : 2022-08-10 02:39:46,351 : cdc_append : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 10,
                "valid_count": 10,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-10 02:39:46,351 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:39:46,351 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer from ./config/schema/deltalake/raw/cdc_append_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:39:46,351 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer
INFO : 2022-08-10 02:39:46,351 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:39:46,443 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:39:46,443 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer
INFO : 2022-08-10 02:39:51,943 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:40:01,097 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:40:01,097 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer_history from ./config/schema/deltalake/raw/cdc_append_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:40:01,098 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer_history
INFO : 2022-08-10 02:40:01,098 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:40:01,164 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer_history at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:40:01,164 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer_history
INFO : 2022-08-10 02:40:03,139 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer_history": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:40:09,148 : cdc_append : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_append with:
                timeslice=2022-08-01 00:00:00.000000 
                retries=1 
                save_type=DefaultSave
INFO : 2022-08-10 02:40:09,180 : cdc_append : cdc_append.py.cdc_append: line(30) : Fetched dst delta table raw.cdc_append_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:40:09,189 : cdc_append : cdc_append.py.cdc_append: line(37) : Fetched dst delta table raw.cdc_append_customer_history from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:40:09,279 : cdc_append : cdc_append.py.cdc_append: line(59) : Change set
+---+-------------------+---------+-------+
|id |extract_date       |load_flag|version|
+---+-------------------+---------+-------+
|1  |2008-01-01 00:00:00|I        |1      |
|2  |2008-01-01 00:00:00|I        |1      |
|3  |2008-01-01 00:00:00|I        |1      |
|4  |2008-01-01 00:00:00|I        |1      |
|5  |2008-01-01 00:00:00|I        |1      |
|6  |2008-01-01 00:00:00|I        |1      |
|7  |2008-01-01 00:00:00|I        |1      |
|8  |2008-01-01 00:00:00|I        |1      |
|9  |2008-01-01 00:00:00|I        |1      |
|10 |2008-01-01 00:00:00|I        |1      |
+---+-------------------+---------+-------+

INFO : 2022-08-10 02:40:10,784 : cdc_append : cdc_append.py.cdc_append: line(109) : Existing History
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:40:12,579 : cdc_append : cdc_append.py.cdc_append: line(111) : New History
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:40:20,843 : cdc_append : cdc_append.py.cdc_append: line(142) : Current
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |d30bab4f-06b1-474f-a8c9-fb538a8bb2a6|2022-08-10 02:39:45.726271|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:40:27,053 : cdc_append : cdc_append.py.cdc_append: line(156) : raw.cdc_append_customer
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:40:27,480 : cdc_append : cdc_append.py.cdc_append: line(159) : raw.cdc_append_customer_history
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:40:27,852 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer
INFO : 2022-08-10 02:40:28,322 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer_history
INFO : 2022-08-10 02:40:28,560 : cdc_append : _delta_lake.py.get_audits: line(48) : {
    "raw.cdc_append_customer": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "3083",
            "numOutputRows": "10",
            "numSourceRows": "10",
            "numTargetChangeFilesAdded": "0",
            "numTargetFilesAdded": "1",
            "numTargetFilesRemoved": "1",
            "numTargetRowsCopied": "10",
            "numTargetRowsDeleted": "0",
            "numTargetRowsInserted": "0",
            "numTargetRowsUpdated": "0",
            "rewriteTimeMs": "1627",
            "scanTimeMs": "1451"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"((src.load_flag IN ('I', 'U')) AND (src.extract_date > dst.extract_date))\",\"actionType\":\"update\"},{\"predicate\":\"(src.load_flag IN ('D'))\",\"actionType\":\"delete\"}]",
            "notMatchedPredicates": "[{\"predicate\":\"(src.load_flag IN ('I', 'U'))\",\"actionType\":\"insert\"}]",
            "predicate": "(src.id = dst.id)"
        },
        "readVersion": 10,
        "timestamp": "2022-08-10 02:40:24.918000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 11
    },
    "raw.cdc_append_customer_history": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "WRITE",
        "operationMetrics": {
            "numFiles": "1",
            "numOutputBytes": "1312",
            "numOutputRows": "0"
        },
        "operationParameters": {
            "mode": "Append",
            "partitionBy": "[]"
        },
        "readVersion": 16,
        "timestamp": "2022-08-10 02:40:19.077000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 17
    }
}
INFO : 2022-08-10 02:40:28,560 : cdc_append : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/config.yaml
INFO : 2022-08-10 02:40:28,563 : cdc_append : _context.py._get_spark_context: line(85) : Setting spark context
INFO : 2022-08-10 02:40:28,591 : cdc_append : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-10 02:40:28,594 : cdc_append : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-10 02:40:28,594 : cdc_append : _context.py.__init__: line(66) : Setting application context dataflow cdc_append
INFO : 2022-08-10 02:40:28,594 : cdc_append : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/cdc_append.yaml
INFO : 2022-08-10 02:40:28,607 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-10 02:40:28,607 : cdc_append : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl-patterns/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:40:28,613 : cdc_append : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=de7bf4f9-6552-4c39-93cb-ec33fee63ce5
INFO : 2022-08-10 02:40:28,613 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-10 02:40:28,664 : cdc_append : _reader.py.create_or_alter_table: line(61) : Exception table already exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/exceptions/landing/exceptions _correlation_id=de7bf4f9-6552-4c39-93cb-ec33fee63ce5
INFO : 2022-08-10 02:40:28,664 : cdc_append : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=de7bf4f9-6552-4c39-93cb-ec33fee63ce5
INFO : 2022-08-10 02:40:28,688 : cdc_append : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=de7bf4f9-6552-4c39-93cb-ec33fee63ce5
INFO : 2022-08-10 02:40:28,927 : cdc_append : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 10,
                "valid_count": 10,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-10 02:40:28,928 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:40:28,928 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer from ./config/schema/deltalake/raw/cdc_append_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:40:28,928 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer
INFO : 2022-08-10 02:40:28,928 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:40:28,968 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:40:28,968 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer
INFO : 2022-08-10 02:40:29,008 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:40:34,824 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:40:34,824 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer_history from ./config/schema/deltalake/raw/cdc_append_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:40:34,825 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer_history
INFO : 2022-08-10 02:40:34,825 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:40:34,863 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer_history at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:40:34,863 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer_history
INFO : 2022-08-10 02:40:34,888 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer_history": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:40:40,818 : cdc_append : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_append with:
                timeslice=2022-08-01 00:00:00.000000 
                retries=1 
                save_type=DefaultSave
INFO : 2022-08-10 02:40:40,829 : cdc_append : cdc_append.py.cdc_append: line(30) : Fetched dst delta table raw.cdc_append_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:40:40,839 : cdc_append : cdc_append.py.cdc_append: line(37) : Fetched dst delta table raw.cdc_append_customer_history from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:40:40,889 : cdc_append : cdc_append.py.cdc_append: line(59) : Change set
+---+-------------------+---------+-------+
|id |extract_date       |load_flag|version|
+---+-------------------+---------+-------+
|1  |2008-01-01 00:00:00|I        |1      |
|2  |2008-01-01 00:00:00|I        |1      |
|3  |2008-01-01 00:00:00|I        |1      |
|4  |2008-01-01 00:00:00|I        |1      |
|5  |2008-01-01 00:00:00|I        |1      |
|6  |2008-01-01 00:00:00|I        |1      |
|7  |2008-01-01 00:00:00|I        |1      |
|8  |2008-01-01 00:00:00|I        |1      |
|9  |2008-01-01 00:00:00|I        |1      |
|10 |2008-01-01 00:00:00|I        |1      |
+---+-------------------+---------+-------+

INFO : 2022-08-10 02:40:41,755 : cdc_append : cdc_append.py.cdc_append: line(109) : Existing History
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:40:43,138 : cdc_append : cdc_append.py.cdc_append: line(111) : New History
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:40:50,220 : cdc_append : cdc_append.py.cdc_append: line(142) : Current
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+-------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount|_correlation_id                     |_load_timestamp          |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+-------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |de7bf4f9-6552-4c39-93cb-ec33fee63ce5|2022-08-10 02:40:28.74683|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+-------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:40:55,392 : cdc_append : cdc_append.py.cdc_append: line(156) : raw.cdc_append_customer
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:40:55,731 : cdc_append : cdc_append.py.cdc_append: line(159) : raw.cdc_append_customer_history
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:40:56,063 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer
INFO : 2022-08-10 02:40:56,331 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer_history
INFO : 2022-08-10 02:40:56,543 : cdc_append : _delta_lake.py.get_audits: line(48) : {
    "raw.cdc_append_customer": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "2427",
            "numOutputRows": "10",
            "numSourceRows": "10",
            "numTargetChangeFilesAdded": "0",
            "numTargetFilesAdded": "1",
            "numTargetFilesRemoved": "1",
            "numTargetRowsCopied": "10",
            "numTargetRowsDeleted": "0",
            "numTargetRowsInserted": "0",
            "numTargetRowsUpdated": "0",
            "rewriteTimeMs": "1263",
            "scanTimeMs": "1160"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"((src.load_flag IN ('I', 'U')) AND (src.extract_date > dst.extract_date))\",\"actionType\":\"update\"},{\"predicate\":\"(src.load_flag IN ('D'))\",\"actionType\":\"delete\"}]",
            "notMatchedPredicates": "[{\"predicate\":\"(src.load_flag IN ('I', 'U'))\",\"actionType\":\"insert\"}]",
            "predicate": "(src.id = dst.id)"
        },
        "readVersion": 14,
        "timestamp": "2022-08-10 02:40:53.577000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 15
    },
    "raw.cdc_append_customer_history": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "WRITE",
        "operationMetrics": {
            "numFiles": "1",
            "numOutputBytes": "1312",
            "numOutputRows": "0"
        },
        "operationParameters": {
            "mode": "Append",
            "partitionBy": "[]"
        },
        "readVersion": 21,
        "timestamp": "2022-08-10 02:40:48.609000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 22
    }
}
INFO : 2022-08-10 02:40:56,544 : cdc_append : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/config.yaml
INFO : 2022-08-10 02:40:56,546 : cdc_append : _context.py._get_spark_context: line(85) : Setting spark context
INFO : 2022-08-10 02:40:56,548 : cdc_append : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-10 02:40:56,550 : cdc_append : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-10 02:40:56,550 : cdc_append : _context.py.__init__: line(66) : Setting application context dataflow cdc_append
INFO : 2022-08-10 02:40:56,551 : cdc_append : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/cdc_append.yaml
INFO : 2022-08-10 02:40:56,561 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-10 02:40:56,561 : cdc_append : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl-patterns/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:40:56,566 : cdc_append : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=e54e20d6-9d9e-4877-a18e-06e809381306
INFO : 2022-08-10 02:40:56,566 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-10 02:40:56,612 : cdc_append : _reader.py.create_or_alter_table: line(61) : Exception table already exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/exceptions/landing/exceptions _correlation_id=e54e20d6-9d9e-4877-a18e-06e809381306
INFO : 2022-08-10 02:40:56,612 : cdc_append : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=e54e20d6-9d9e-4877-a18e-06e809381306
INFO : 2022-08-10 02:40:56,630 : cdc_append : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=e54e20d6-9d9e-4877-a18e-06e809381306
INFO : 2022-08-10 02:40:56,846 : cdc_append : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 7,
                "valid_count": 7,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-10 02:40:56,846 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:40:56,846 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer from ./config/schema/deltalake/raw/cdc_append_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:40:56,846 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer
INFO : 2022-08-10 02:40:56,847 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:40:56,878 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:40:56,878 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer
INFO : 2022-08-10 02:40:56,909 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:41:02,128 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:41:02,128 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer_history from ./config/schema/deltalake/raw/cdc_append_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:41:02,128 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:02,128 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:41:02,161 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer_history at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:41:02,161 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:02,182 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer_history": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:41:07,409 : cdc_append : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_append with:
                timeslice=2022-08-02 00:00:00.000000 
                retries=1 
                save_type=DefaultSave
INFO : 2022-08-10 02:41:07,421 : cdc_append : cdc_append.py.cdc_append: line(30) : Fetched dst delta table raw.cdc_append_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:41:07,432 : cdc_append : cdc_append.py.cdc_append: line(37) : Fetched dst delta table raw.cdc_append_customer_history from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:41:07,480 : cdc_append : cdc_append.py.cdc_append: line(59) : Change set
+---+-------------------+---------+-------+
|id |extract_date       |load_flag|version|
+---+-------------------+---------+-------+
|1  |2008-01-01 00:00:00|I        |2      |
|1  |2008-01-02 00:00:00|U        |1      |
|2  |2008-01-01 00:00:00|I        |2      |
|2  |2008-01-02 00:00:00|U        |1      |
|3  |2008-01-01 00:00:00|I        |2      |
|3  |2008-01-02 00:00:00|D        |1      |
|11 |2008-01-02 00:00:00|I        |1      |
|12 |2008-01-02 00:00:00|I        |1      |
|13 |2008-01-02 00:00:00|I        |1      |
|14 |2008-01-02 00:00:00|I        |1      |
+---+-------------------+---------+-------+

INFO : 2022-08-10 02:41:08,317 : cdc_append : cdc_append.py.cdc_append: line(109) : Existing History
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name|email                    |gender |job_title         |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier   |dlegier0@mail.ru         |Agender|Editor            |86.5  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman  |pscirman1@kickstarter.com|Male   |Junior Executive  |36.18 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics |cickowics2@booking.com   |Male   |Research Associate|35.54 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:09,613 : cdc_append : cdc_append.py.cdc_append: line(111) : New History
+-------------------+---------+---+----------+---------+----------------------+------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name|email                 |gender|job_title         |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------+----------------------+------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-02 00:00:00|D        |3  |Chic      |Ickowics |cickowics2@booking.com|Male  |Research Associate|35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+---------+----------------------+------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:16,659 : cdc_append : cdc_append.py.cdc_append: line(142) : Current
+-------------------+---------+---+----------+---------------+-----------------------------+-------+--------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender |job_title           |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+-------+--------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-02 00:00:00|U        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender|Super Hero          |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|U        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Female |Senior Executive    |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|D        |3  |Chic      |Ickowics       |cickowics2@booking.com       |Male   |Research Associate  |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |11 |Davidde   |Legier         |dlegier0@mail.ru             |Agender|Editor              |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |12 |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male   |Junior Executive    |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |13 |Chic      |Ickowics       |cickowics2@booking.com       |Male   |Research Associate  |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |14 |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male   |Safety Technician IV|73.21 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+-------+--------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:21,682 : cdc_append : cdc_append.py.cdc_append: line(156) : raw.cdc_append_customer
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-02 00:00:00|U        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Super Hero             |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|U        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Female    |Senior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|I        |11 |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |12 |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |13 |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |14 |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:22,014 : cdc_append : cdc_append.py.cdc_append: line(159) : raw.cdc_append_customer_history
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name|email                    |gender |job_title         |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier   |dlegier0@mail.ru         |Agender|Editor            |86.5  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman  |pscirman1@kickstarter.com|Male   |Junior Executive  |36.18 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics |cickowics2@booking.com   |Male   |Research Associate|35.54 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|D        |3  |Chic      |Ickowics |cickowics2@booking.com   |Male   |Research Associate|35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:22,343 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer
INFO : 2022-08-10 02:41:22,595 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:22,787 : cdc_append : _delta_lake.py.get_audits: line(48) : {
    "raw.cdc_append_customer": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "2421",
            "numOutputRows": "13",
            "numSourceRows": "7",
            "numTargetChangeFilesAdded": "1",
            "numTargetFilesAdded": "1",
            "numTargetFilesRemoved": "1",
            "numTargetRowsCopied": "7",
            "numTargetRowsDeleted": "1",
            "numTargetRowsInserted": "4",
            "numTargetRowsUpdated": "2",
            "rewriteTimeMs": "1251",
            "scanTimeMs": "1166"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"((src.load_flag IN ('I', 'U')) AND (src.extract_date > dst.extract_date))\",\"actionType\":\"update\"},{\"predicate\":\"(src.load_flag IN ('D'))\",\"actionType\":\"delete\"}]",
            "notMatchedPredicates": "[{\"predicate\":\"(src.load_flag IN ('I', 'U'))\",\"actionType\":\"insert\"}]",
            "predicate": "(src.id = dst.id)"
        },
        "readVersion": 18,
        "timestamp": "2022-08-10 02:41:19.904000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 19
    },
    "raw.cdc_append_customer_history": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "WRITE",
        "operationMetrics": {
            "numFiles": "1",
            "numOutputBytes": "4339",
            "numOutputRows": "1"
        },
        "operationParameters": {
            "mode": "Append",
            "partitionBy": "[]"
        },
        "readVersion": 26,
        "timestamp": "2022-08-10 02:41:15.025000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 27
    }
}
INFO : 2022-08-10 02:41:22,787 : cdc_append : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/config.yaml
INFO : 2022-08-10 02:41:22,790 : cdc_append : _context.py._get_spark_context: line(85) : Setting spark context
INFO : 2022-08-10 02:41:22,793 : cdc_append : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-10 02:41:22,796 : cdc_append : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-10 02:41:22,796 : cdc_append : _context.py.__init__: line(66) : Setting application context dataflow cdc_append
INFO : 2022-08-10 02:41:22,796 : cdc_append : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/cdc_append.yaml
INFO : 2022-08-10 02:41:22,807 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-10 02:41:22,808 : cdc_append : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl-patterns/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:41:22,813 : cdc_append : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=536f5f2d-b58b-4fb2-9603-7a86c389dd6f
INFO : 2022-08-10 02:41:22,813 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-10 02:41:22,855 : cdc_append : _reader.py.create_or_alter_table: line(61) : Exception table already exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/exceptions/landing/exceptions _correlation_id=536f5f2d-b58b-4fb2-9603-7a86c389dd6f
INFO : 2022-08-10 02:41:22,855 : cdc_append : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=536f5f2d-b58b-4fb2-9603-7a86c389dd6f
INFO : 2022-08-10 02:41:22,872 : cdc_append : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=536f5f2d-b58b-4fb2-9603-7a86c389dd6f
INFO : 2022-08-10 02:41:23,059 : cdc_append : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 7,
                "valid_count": 7,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-10 02:41:23,059 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:41:23,059 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer from ./config/schema/deltalake/raw/cdc_append_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:41:23,060 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer
INFO : 2022-08-10 02:41:23,060 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:41:23,089 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:41:23,089 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer
INFO : 2022-08-10 02:41:23,118 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:41:28,747 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:41:28,747 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer_history from ./config/schema/deltalake/raw/cdc_append_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:41:28,747 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:28,747 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:41:28,779 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer_history at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:41:28,779 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:28,800 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer_history": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:41:34,466 : cdc_append : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_append with:
                timeslice=2022-08-02 00:00:00.000000 
                retries=1 
                save_type=DefaultSave
INFO : 2022-08-10 02:41:34,476 : cdc_append : cdc_append.py.cdc_append: line(30) : Fetched dst delta table raw.cdc_append_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:41:34,485 : cdc_append : cdc_append.py.cdc_append: line(37) : Fetched dst delta table raw.cdc_append_customer_history from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:41:34,532 : cdc_append : cdc_append.py.cdc_append: line(59) : Change set
+---+-------------------+---------+-------+
|id |extract_date       |load_flag|version|
+---+-------------------+---------+-------+
|1  |2008-01-01 00:00:00|I        |2      |
|1  |2008-01-02 00:00:00|U        |1      |
|2  |2008-01-01 00:00:00|I        |2      |
|2  |2008-01-02 00:00:00|U        |1      |
|3  |2008-01-01 00:00:00|I        |2      |
|3  |2008-01-02 00:00:00|D        |1      |
|11 |2008-01-02 00:00:00|I        |1      |
|12 |2008-01-02 00:00:00|I        |1      |
|13 |2008-01-02 00:00:00|I        |1      |
|14 |2008-01-02 00:00:00|I        |1      |
+---+-------------------+---------+-------+

INFO : 2022-08-10 02:41:35,380 : cdc_append : cdc_append.py.cdc_append: line(109) : Existing History
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:41:36,645 : cdc_append : cdc_append.py.cdc_append: line(111) : New History
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
|extract_date|load_flag|id |first_name|last_name|email|gender|job_title|amount|_correlation_id|_load_timestamp|_filename|
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+
+------------+---------+---+----------+---------+-----+------+---------+------+---------------+---------------+---------+

INFO : 2022-08-10 02:41:43,421 : cdc_append : cdc_append.py.cdc_append: line(142) : Current
+-------------------+---------+---+----------+---------------+-----------------------------+-------+--------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender |job_title           |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+-------+--------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-02 00:00:00|U        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender|Super Hero          |86.5  |536f5f2d-b58b-4fb2-9603-7a86c389dd6f|2022-08-10 02:41:22.920344|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|U        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Female |Senior Executive    |36.18 |536f5f2d-b58b-4fb2-9603-7a86c389dd6f|2022-08-10 02:41:22.920344|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|D        |3  |Chic      |Ickowics       |cickowics2@booking.com       |Male   |Research Associate  |35.54 |536f5f2d-b58b-4fb2-9603-7a86c389dd6f|2022-08-10 02:41:22.920344|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |11 |Davidde   |Legier         |dlegier0@mail.ru             |Agender|Editor              |86.5  |536f5f2d-b58b-4fb2-9603-7a86c389dd6f|2022-08-10 02:41:22.920344|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |12 |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male   |Junior Executive    |36.18 |536f5f2d-b58b-4fb2-9603-7a86c389dd6f|2022-08-10 02:41:22.920344|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |13 |Chic      |Ickowics       |cickowics2@booking.com       |Male   |Research Associate  |35.54 |536f5f2d-b58b-4fb2-9603-7a86c389dd6f|2022-08-10 02:41:22.920344|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |14 |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male   |Safety Technician IV|73.21 |536f5f2d-b58b-4fb2-9603-7a86c389dd6f|2022-08-10 02:41:22.920344|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+-------+--------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:48,306 : cdc_append : cdc_append.py.cdc_append: line(156) : raw.cdc_append_customer
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-02 00:00:00|U        |1  |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Super Hero             |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|U        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Female    |Senior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|I        |11 |Davidde   |Legier         |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |12 |Panchito  |Scirman        |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |13 |Chic      |Ickowics       |cickowics2@booking.com       |Male      |Research Associate     |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |14 |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:48,630 : cdc_append : cdc_append.py.cdc_append: line(159) : raw.cdc_append_customer_history
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name|email                    |gender |job_title         |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier   |dlegier0@mail.ru         |Agender|Editor            |86.5  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman  |pscirman1@kickstarter.com|Male   |Junior Executive  |36.18 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics |cickowics2@booking.com   |Male   |Research Associate|35.54 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|D        |3  |Chic      |Ickowics |cickowics2@booking.com   |Male   |Research Associate|35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+---------+-------------------------+-------+------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:41:48,977 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer
INFO : 2022-08-10 02:41:49,231 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:49,419 : cdc_append : _delta_lake.py.get_audits: line(48) : {
    "raw.cdc_append_customer": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "2321",
            "numOutputRows": "13",
            "numSourceRows": "7",
            "numTargetChangeFilesAdded": "0",
            "numTargetFilesAdded": "1",
            "numTargetFilesRemoved": "1",
            "numTargetRowsCopied": "13",
            "numTargetRowsDeleted": "0",
            "numTargetRowsInserted": "0",
            "numTargetRowsUpdated": "0",
            "rewriteTimeMs": "1186",
            "scanTimeMs": "1132"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"((src.load_flag IN ('I', 'U')) AND (src.extract_date > dst.extract_date))\",\"actionType\":\"update\"},{\"predicate\":\"(src.load_flag IN ('D'))\",\"actionType\":\"delete\"}]",
            "notMatchedPredicates": "[{\"predicate\":\"(src.load_flag IN ('I', 'U'))\",\"actionType\":\"insert\"}]",
            "predicate": "(src.id = dst.id)"
        },
        "readVersion": 22,
        "timestamp": "2022-08-10 02:41:46.575000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 23
    },
    "raw.cdc_append_customer_history": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "WRITE",
        "operationMetrics": {
            "numFiles": "1",
            "numOutputBytes": "1312",
            "numOutputRows": "0"
        },
        "operationParameters": {
            "mode": "Append",
            "partitionBy": "[]"
        },
        "readVersion": 31,
        "timestamp": "2022-08-10 02:41:41.839000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 32
    }
}
INFO : 2022-08-10 02:41:49,419 : cdc_append : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/config.yaml
INFO : 2022-08-10 02:41:49,422 : cdc_append : _context.py._get_spark_context: line(85) : Setting spark context
INFO : 2022-08-10 02:41:49,426 : cdc_append : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-10 02:41:49,428 : cdc_append : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-10 02:41:49,429 : cdc_append : _context.py.__init__: line(66) : Setting application context dataflow cdc_append
INFO : 2022-08-10 02:41:49,429 : cdc_append : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/cdc_append.yaml
INFO : 2022-08-10 02:41:49,440 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-10 02:41:49,440 : cdc_append : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl-patterns/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:41:49,446 : cdc_append : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=b0292cec-d239-458f-9463-172260d5bf00
INFO : 2022-08-10 02:41:49,446 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-10 02:41:49,490 : cdc_append : _reader.py.create_or_alter_table: line(61) : Exception table already exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/exceptions/landing/exceptions _correlation_id=b0292cec-d239-458f-9463-172260d5bf00
INFO : 2022-08-10 02:41:49,490 : cdc_append : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=b0292cec-d239-458f-9463-172260d5bf00
INFO : 2022-08-10 02:41:49,506 : cdc_append : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=b0292cec-d239-458f-9463-172260d5bf00
INFO : 2022-08-10 02:41:49,686 : cdc_append : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 11,
                "valid_count": 11,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-10 02:41:49,686 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:41:49,687 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer from ./config/schema/deltalake/raw/cdc_append_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:41:49,687 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer
INFO : 2022-08-10 02:41:49,687 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:41:49,715 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:41:49,715 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer
INFO : 2022-08-10 02:41:49,744 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:41:54,817 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:41:54,817 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer_history from ./config/schema/deltalake/raw/cdc_append_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:41:54,818 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:54,818 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:41:54,848 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer_history at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:41:54,849 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer_history
INFO : 2022-08-10 02:41:54,869 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer_history": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:41:59,947 : cdc_append : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_append with:
                timeslice=2022-08-03 00:00:00.000000 
                retries=1 
                save_type=DefaultSave
INFO : 2022-08-10 02:41:59,958 : cdc_append : cdc_append.py.cdc_append: line(30) : Fetched dst delta table raw.cdc_append_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:41:59,967 : cdc_append : cdc_append.py.cdc_append: line(37) : Fetched dst delta table raw.cdc_append_customer_history from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:42:00,010 : cdc_append : cdc_append.py.cdc_append: line(59) : Change set
+---+-------------------+---------+-------+
|id |extract_date       |load_flag|version|
+---+-------------------+---------+-------+
|1  |2008-01-01 00:00:00|I        |3      |
|1  |2008-01-02 00:00:00|U        |2      |
|1  |2008-01-03 00:00:00|U        |1      |
|3  |2008-01-01 00:00:00|I        |3      |
|3  |2008-01-02 00:00:00|D        |2      |
|3  |2008-01-03 00:00:00|I        |1      |
|8  |2008-01-01 00:00:00|I        |2      |
|8  |2008-01-03 00:00:00|U        |1      |
|9  |2008-01-01 00:00:00|I        |2      |
|9  |2008-01-03 00:00:00|D        |1      |
|10 |2008-01-01 00:00:00|I        |2      |
|10 |2008-01-03 00:00:00|U        |1      |
|11 |2008-01-02 00:00:00|I        |2      |
|11 |2008-01-03 00:00:00|U        |1      |
|12 |2008-01-02 00:00:00|I        |2      |
|12 |2008-01-03 00:00:00|U        |1      |
|13 |2008-01-02 00:00:00|I        |2      |
|13 |2008-01-03 00:00:00|D        |1      |
|15 |2008-01-03 00:00:00|I        |1      |
|16 |2008-01-03 00:00:00|I        |1      |
+---+-------------------+---------+-------+
only showing top 20 rows

INFO : 2022-08-10 02:42:00,841 : cdc_append : cdc_append.py.cdc_append: line(109) : Existing History
+-------------------+---------+---+----------+-----------+-------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name  |email                    |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+-----------+-------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-02 00:00:00|U        |1  |Davidde   |Legier     |dlegier0@mail.ru         |Agender   |Super Hero             |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale|ahollingdale7@yahoo.co.jp|Female    |Cost Accountant        |21.94 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth  |choldforth8@ca.gov       |Non-binary|Chief Design Engineer  |72.0  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty      |bfenty9@paginegialle.it  |Female    |Assistant Media Planner|38.98 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|I        |11 |Davidde   |Legier     |dlegier0@mail.ru         |Agender   |Editor                 |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |12 |Panchito  |Scirman    |pscirman1@kickstarter.com|Male      |Junior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |13 |Chic      |Ickowics   |cickowics2@booking.com   |Male      |Research Associate     |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
+-------------------+---------+---+----------+-----------+-------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:02,104 : cdc_append : cdc_append.py.cdc_append: line(111) : New History
+-------------------+---------+---+----------+---------+----------------------+----------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name|email                 |gender    |job_title            |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------+----------------------+----------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-03 00:00:00|D        |9  |Chaunce   |Holdforth|choldforth8@ca.gov    |Non-binary|Chief Design Engineer|72.0  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|D        |13 |Chic      |Ickowics |cickowics2@booking.com|Male      |Research Associate   |100.0 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
+-------------------+---------+---+----------+---------+----------------------+----------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:08,916 : cdc_append : cdc_append.py.cdc_append: line(142) : Current
+-------------------+---------+---+----------+-----------------+---------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name        |email                      |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+-----------------+---------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-03 00:00:00|U        |1  |Davidde   |Legier           |dlegier0@mail.ru           |Agender   |Super Villain          |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |3  |Chic      |Ickowics         |wowiback@booking.com       |Male      |Research Associate     |35.54 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |8  |Anstice   |Hollingdale Sauce|ahollingdale7@yahoo.co.jp  |Female    |Cost Accountant        |21.94 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|D        |9  |Chaunce   |Holdforth        |choldforth8@ca.gov         |Non-binary|Chief Design Engineer  |72.0  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |10 |Blinni    |Blimey           |bfenty9@paginegialle.it    |Female    |Assistant Media Planner|38.98 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |11 |Tom       |Jerry            |dlegier0@mail.ru           |Agender   |Editor                 |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |12 |Panchito  |Scirman          |pscirman1@failedstarter.com|Male      |Junior Executive       |36.18 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|D        |13 |Chic      |Ickowics         |cickowics2@booking.com     |Male      |Research Associate     |100.0 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |15 |Sara      |Whiterod         |swhiterod4@hhs.gov         |Female    |Assistant Manager      |47.85 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |16 |Mariska   |Antrum           |mantrum5@nytimes.com       |Female    |Tax Accountant         |16.37 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |17 |Ingemar   |Petrus           |ipetrus6@blogspot.com      |Male      |Chief Design Engineer  |49.02 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
+-------------------+---------+---+----------+-----------------+---------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:13,786 : cdc_append : cdc_append.py.cdc_append: line(156) : raw.cdc_append_customer
+-------------------+---------+---+----------+-----------------+-----------------------------+-------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name        |email                        |gender |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+-----------------+-----------------------------+-------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-03 00:00:00|U        |1  |Davidde   |Legier           |dlegier0@mail.ru             |Agender|Super Villain          |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-02 00:00:00|U        |2  |Panchito  |Scirman          |pscirman1@kickstarter.com    |Female |Senior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|I        |3  |Chic      |Ickowics         |wowiback@booking.com         |Male   |Research Associate     |35.54 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz  |pjedrzaszkiewicz3@auda.org.au|Male   |Safety Technician IV   |73.21 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod         |swhiterod4@hhs.gov           |Female |Assistant Manager      |47.85 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum           |mantrum5@nytimes.com         |Female |Tax Accountant         |16.37 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus           |ipetrus6@blogspot.com        |Male   |Chief Design Engineer  |49.02 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-03 00:00:00|U        |8  |Anstice   |Hollingdale Sauce|ahollingdale7@yahoo.co.jp    |Female |Cost Accountant        |21.94 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |10 |Blinni    |Blimey           |bfenty9@paginegialle.it      |Female |Assistant Media Planner|38.98 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |11 |Tom       |Jerry            |dlegier0@mail.ru             |Agender|Editor                 |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |12 |Panchito  |Scirman          |pscirman1@failedstarter.com  |Male   |Junior Executive       |36.18 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-02 00:00:00|I        |14 |Pascale   |Jedrzaszkiewicz  |pjedrzaszkiewicz3@auda.org.au|Male   |Safety Technician IV   |73.21 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|I        |15 |Sara      |Whiterod         |swhiterod4@hhs.gov           |Female |Assistant Manager      |47.85 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |16 |Mariska   |Antrum           |mantrum5@nytimes.com         |Female |Tax Accountant         |16.37 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |17 |Ingemar   |Petrus           |ipetrus6@blogspot.com        |Male   |Chief Design Engineer  |49.02 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
+-------------------+---------+---+----------+-----------------+-----------------------------+-------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:14,113 : cdc_append : cdc_append.py.cdc_append: line(159) : raw.cdc_append_customer_history
+-------------------+---------+---+----------+-----------+-------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name  |email                    |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+-----------+-------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier     |dlegier0@mail.ru         |Agender   |Editor                 |86.5  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|U        |1  |Davidde   |Legier     |dlegier0@mail.ru         |Agender   |Super Hero             |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman    |pscirman1@kickstarter.com|Male      |Junior Executive       |36.18 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics   |cickowics2@booking.com   |Male      |Research Associate     |35.54 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|D        |3  |Chic      |Ickowics   |cickowics2@booking.com   |Male      |Research Associate     |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale|ahollingdale7@yahoo.co.jp|Female    |Cost Accountant        |21.94 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth  |choldforth8@ca.gov       |Non-binary|Chief Design Engineer  |72.0  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-03 00:00:00|D        |9  |Chaunce   |Holdforth  |choldforth8@ca.gov       |Non-binary|Chief Design Engineer  |72.0  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty      |bfenty9@paginegialle.it  |Female    |Assistant Media Planner|38.98 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|I        |11 |Davidde   |Legier     |dlegier0@mail.ru         |Agender   |Editor                 |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |12 |Panchito  |Scirman    |pscirman1@kickstarter.com|Male      |Junior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |13 |Chic      |Ickowics   |cickowics2@booking.com   |Male      |Research Associate     |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|D        |13 |Chic      |Ickowics   |cickowics2@booking.com   |Male      |Research Associate     |100.0 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
+-------------------+---------+---+----------+-----------+-------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:14,459 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer
INFO : 2022-08-10 02:42:14,710 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer_history
INFO : 2022-08-10 02:42:14,899 : cdc_append : _delta_lake.py.get_audits: line(48) : {
    "raw.cdc_append_customer": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "2301",
            "numOutputRows": "15",
            "numSourceRows": "11",
            "numTargetChangeFilesAdded": "1",
            "numTargetFilesAdded": "1",
            "numTargetFilesRemoved": "1",
            "numTargetRowsCopied": "6",
            "numTargetRowsDeleted": "2",
            "numTargetRowsInserted": "4",
            "numTargetRowsUpdated": "5",
            "rewriteTimeMs": "1193",
            "scanTimeMs": "1104"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"((src.load_flag IN ('I', 'U')) AND (src.extract_date > dst.extract_date))\",\"actionType\":\"update\"},{\"predicate\":\"(src.load_flag IN ('D'))\",\"actionType\":\"delete\"}]",
            "notMatchedPredicates": "[{\"predicate\":\"(src.load_flag IN ('I', 'U'))\",\"actionType\":\"insert\"}]",
            "predicate": "(src.id = dst.id)"
        },
        "readVersion": 26,
        "timestamp": "2022-08-10 02:42:12.040000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 27
    },
    "raw.cdc_append_customer_history": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "WRITE",
        "operationMetrics": {
            "numFiles": "1",
            "numOutputBytes": "4424",
            "numOutputRows": "2"
        },
        "operationParameters": {
            "mode": "Append",
            "partitionBy": "[]"
        },
        "readVersion": 36,
        "timestamp": "2022-08-10 02:42:07.341000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 37
    }
}
INFO : 2022-08-10 02:42:14,899 : cdc_append : _config_provider.py.load_config: line(41) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/config.yaml
INFO : 2022-08-10 02:42:14,901 : cdc_append : _context.py._get_spark_context: line(85) : Setting spark context
INFO : 2022-08-10 02:42:14,905 : cdc_append : _context.py.__init__: line(50) : Setting application context spark logger at level ERROR
INFO : 2022-08-10 02:42:14,907 : cdc_append : _factory.py.get_file_system_type: line(50) : Setting filestystem using protocol file:
INFO : 2022-08-10 02:42:14,907 : cdc_append : _context.py.__init__: line(66) : Setting application context dataflow cdc_append
INFO : 2022-08-10 02:42:14,907 : cdc_append : _config_provider.py.load_pipeline_config: line(29) : Loading Dataflow configuration from file /Users/shaunryan/AzureDevOps/yetl-patterns/config/pipeline/local/cdc_append.yaml
INFO : 2022-08-10 02:42:14,918 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on spark_schema_file 
INFO : 2022-08-10 02:42:14,918 : cdc_append : _spark_file_schema_repo.py.load_schema: line(50) : Loading schema for dataset landing.cdc_customer from /Users/shaunryan/AzureDevOps/yetl-patterns/config/schema/spark/landing/cdc_customer.yaml using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:42:14,923 : cdc_append : _reader.py.__init__: line(49) : auto_io = True automatically creating or altering exception delta table landing.cdc_customer _correlation_id=e3c8e48a-47e7-472c-8088-c59d55816340
INFO : 2022-08-10 02:42:14,923 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `landing`
INFO : 2022-08-10 02:42:14,965 : cdc_append : _reader.py.create_or_alter_table: line(61) : Exception table already exists landing.exceptions at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/exceptions/landing/exceptions _correlation_id=e3c8e48a-47e7-472c-8088-c59d55816340
INFO : 2022-08-10 02:42:14,965 : cdc_append : _reader.py.read: line(195) : Reading data for landing.cdc_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv with options {'mode': 'PERMISSIVE', 'inferSchema': False, 'header': True, 'timestampFormat': 'yyyy-MM-dd HH:mm:ss'} _correlation_id=e3c8e48a-47e7-472c-8088-c59d55816340
INFO : 2022-08-10 02:42:14,981 : cdc_append : _reader.py.validate: line(181) : Validating dataframe read using PERMISSIVE corrupt column at _corrupt_record _correlation_id=e3c8e48a-47e7-472c-8088-c59d55816340
INFO : 2022-08-10 02:42:15,158 : cdc_append : _reader.py.validate: line(192) : {
    "validation": {
        "schema_on_read": {
            "landing.cdc_customer": {
                "total_count": 9,
                "valid_count": 9,
                "exception_count": 0
            }
        }
    }
}
INFO : 2022-08-10 02:42:15,158 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:42:15,158 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer from ./config/schema/deltalake/raw/cdc_append_customer.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:42:15,159 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer
INFO : 2022-08-10 02:42:15,159 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:42:15,186 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:42:15,186 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer
INFO : 2022-08-10 02:42:15,214 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:42:20,823 : cdc_append : _factory.py.get_schema_repo_type: line(39) : Setting up schema repo on deltalake_sql_file 
INFO : 2022-08-10 02:42:20,824 : cdc_append : _deltalake_sql_file.py.load_schema: line(43) : Loading schema for dataset raw.cdc_append_customer_history from ./config/schema/deltalake/raw/cdc_append_customer_history.sql using <class 'yetl_flow.file_system._file_system.FileSystem'>
INFO : 2022-08-10 02:42:20,824 : cdc_append : _writer.py.__init__: line(40) : auto_io = True automatically creating or altering delta table raw.cdc_append_customer_history
INFO : 2022-08-10 02:42:20,824 : cdc_append : _delta_lake.py.create_database: line(27) : Creating database if not exists `raw`
INFO : 2022-08-10 02:42:20,856 : cdc_append : _writer.py.create_or_alter_table: line(88) : Table already exists raw.cdc_append_customer_history at file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:42:20,856 : cdc_append : _delta_lake.py.get_table_properties: line(69) : getting existing table properties for table raw.cdc_append_customer_history
INFO : 2022-08-10 02:42:20,879 : cdc_append : _delta_lake.py.get_table_properties: line(91) : {
    "raw.cdc_append_customer_history": {
        "constraints": {
            "amount_lower_bound": "amount > - 1000",
            "amount_upper_bound": "amount < 1000000"
        },
        "properties": {
            "Type": "EXTERNAL",
            "delta.appendOnly": "False",
            "delta.checkpoint.writeStatsAsJson": "True",
            "delta.compatibility.symlinkFormatManifest.enabled": "False",
            "delta.dataSkippingNumIndexedCols": "-1",
            "delta.deletedFileRetentionDuration": "interval 1 week",
            "delta.enableChangeDataFeed": "True",
            "delta.logRetentionDuration": "interval 30 days",
            "delta.minReaderVersion": "1",
            "delta.minWriterVersion": "4",
            "delta.randomPrefixLength": "2",
            "delta.randomizeFilePrefixes": "False",
            "external": "true"
        }
    }
}
INFO : 2022-08-10 02:42:26,450 : cdc_append : _framework.py.wrap_function: line(36) : Executing Dataflow cdc_append with:
                timeslice=2022-08-04 00:00:00.000000 
                retries=1 
                save_type=DefaultSave
INFO : 2022-08-10 02:42:26,461 : cdc_append : cdc_append.py.cdc_append: line(30) : Fetched dst delta table raw.cdc_append_customer from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer
INFO : 2022-08-10 02:42:26,471 : cdc_append : cdc_append.py.cdc_append: line(37) : Fetched dst delta table raw.cdc_append_customer_history from file:/Users/shaunryan/AzureDevOps/yetl-patterns/data/delta_lake/raw/cdc_append_customer_history
INFO : 2022-08-10 02:42:26,517 : cdc_append : cdc_append.py.cdc_append: line(59) : Change set
+---+-------------------+---------+-------+
|id |extract_date       |load_flag|version|
+---+-------------------+---------+-------+
|1  |2008-01-01 00:00:00|I        |4      |
|1  |2008-01-02 00:00:00|U        |3      |
|1  |2008-01-03 00:00:00|U        |2      |
|1  |2008-01-04 00:00:00|U        |1      |
|7  |2008-01-01 00:00:00|I        |2      |
|7  |2008-01-04 00:00:00|D        |1      |
|8  |2008-01-01 00:00:00|I        |3      |
|8  |2008-01-03 00:00:00|U        |2      |
|8  |2008-01-04 00:00:00|U        |1      |
|11 |2008-01-02 00:00:00|I        |3      |
|11 |2008-01-03 00:00:00|U        |2      |
|11 |2008-01-04 00:00:00|U        |1      |
|14 |2008-01-02 00:00:00|I        |2      |
|14 |2008-01-04 00:00:00|D        |1      |
|17 |2008-01-03 00:00:00|I        |2      |
|17 |2008-01-04 00:00:00|I        |1      |
|18 |2008-01-04 00:00:00|I        |1      |
|19 |2008-01-04 00:00:00|I        |1      |
|20 |2008-01-04 00:00:00|I        |1      |
+---+-------------------+---------+-------+

INFO : 2022-08-10 02:42:27,341 : cdc_append : cdc_append.py.cdc_append: line(109) : Existing History
+-------------------+---------+---+----------+-----------------+-----------------------------+-------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name        |email                        |gender |job_title            |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+-----------------+-----------------------------+-------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-03 00:00:00|U        |1  |Davidde   |Legier           |dlegier0@mail.ru             |Agender|Super Villain        |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus           |ipetrus6@blogspot.com        |Male   |Chief Design Engineer|49.02 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-03 00:00:00|U        |8  |Anstice   |Hollingdale Sauce|ahollingdale7@yahoo.co.jp    |Female |Cost Accountant      |21.94 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|U        |11 |Tom       |Jerry            |dlegier0@mail.ru             |Agender|Editor               |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-02 00:00:00|I        |14 |Pascale   |Jedrzaszkiewicz  |pjedrzaszkiewicz3@auda.org.au|Male   |Safety Technician IV |73.21 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|I        |17 |Ingemar   |Petrus           |ipetrus6@blogspot.com        |Male   |Chief Design Engineer|49.02 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
+-------------------+---------+---+----------+-----------------+-----------------------------+-------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:28,613 : cdc_append : cdc_append.py.cdc_append: line(111) : New History
+-------------------+---------+---+----------+---------------+-----------------------------+------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender|job_title            |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-04 00:00:00|D        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male  |Chief Design Engineer|49.02 |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|D        |14 |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male  |Safety Technician IV |73.21 |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+------+---------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:35,340 : cdc_append : cdc_append.py.cdc_append: line(142) : Current
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+-------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount |_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+-------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-04 00:00:00|U        |1  |David     |Legier         |dlegier0@mail.ru             |Agender   |Super Hero             |86.5   |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|D        |7  |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|U        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Profit Accountant      |21.94  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|U        |11 |Tom       |Jerry          |dlegier0@mail.ru             |Agender   |PM of England          |10000.5|e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|D        |14 |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|I        |17 |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|I        |18 |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|I        |19 |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0   |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|I        |20 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+-------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:40,186 : cdc_append : cdc_append.py.cdc_append: line(156) : raw.cdc_append_customer
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+-------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name      |email                        |gender    |job_title              |amount |_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+-------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-04 00:00:00|U        |1  |David     |Legier         |dlegier0@mail.ru             |Agender   |Super Hero             |86.5   |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-02 00:00:00|U        |2  |Panchito  |Scirman        |pscirman1@kickstarter.com    |Female    |Senior Executive       |36.18  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|I        |3  |Chic      |Ickowics       |wowiback@booking.com         |Male      |Research Associate     |35.54  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-01 00:00:00|I        |4  |Pascale   |Jedrzaszkiewicz|pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |5  |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |6  |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-04 00:00:00|U        |8  |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Profit Accountant      |21.94  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-03 00:00:00|U        |10 |Blinni    |Blimey         |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-04 00:00:00|U        |11 |Tom       |Jerry          |dlegier0@mail.ru             |Agender   |PM of England          |10000.5|e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-03 00:00:00|U        |12 |Panchito  |Scirman        |pscirman1@failedstarter.com  |Male      |Junior Executive       |36.18  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |15 |Sara      |Whiterod       |swhiterod4@hhs.gov           |Female    |Assistant Manager      |47.85  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-03 00:00:00|I        |16 |Mariska   |Antrum         |mantrum5@nytimes.com         |Female    |Tax Accountant         |16.37  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-04 00:00:00|I        |17 |Ingemar   |Petrus         |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|I        |18 |Anstice   |Hollingdale    |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|I        |19 |Chaunce   |Holdforth      |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0   |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-04 00:00:00|I        |20 |Blinni    |Fenty          |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98  |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
+-------------------+---------+---+----------+---------------+-----------------------------+----------+-----------------------+-------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+

INFO : 2022-08-10 02:42:40,506 : cdc_append : cdc_append.py.cdc_append: line(159) : raw.cdc_append_customer_history
+-------------------+---------+---+----------+-----------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|extract_date       |load_flag|id |first_name|last_name        |email                        |gender    |job_title              |amount|_correlation_id                     |_load_timestamp           |_filename                                                                                      |
+-------------------+---------+---+----------+-----------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
|2008-01-01 00:00:00|I        |1  |Davidde   |Legier           |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|U        |1  |Davidde   |Legier           |dlegier0@mail.ru             |Agender   |Super Hero             |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|U        |1  |Davidde   |Legier           |dlegier0@mail.ru             |Agender   |Super Villain          |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-01 00:00:00|I        |2  |Panchito  |Scirman          |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-01 00:00:00|I        |3  |Chic      |Ickowics         |cickowics2@booking.com       |Male      |Research Associate     |35.54 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|D        |3  |Chic      |Ickowics         |cickowics2@booking.com       |Male      |Research Associate     |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-01 00:00:00|I        |7  |Ingemar   |Petrus           |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-04 00:00:00|D        |7  |Ingemar   |Petrus           |ipetrus6@blogspot.com        |Male      |Chief Design Engineer  |49.02 |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
|2008-01-01 00:00:00|I        |8  |Anstice   |Hollingdale      |ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-03 00:00:00|U        |8  |Anstice   |Hollingdale Sauce|ahollingdale7@yahoo.co.jp    |Female    |Cost Accountant        |21.94 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-01 00:00:00|I        |9  |Chaunce   |Holdforth        |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-03 00:00:00|D        |9  |Chaunce   |Holdforth        |choldforth8@ca.gov           |Non-binary|Chief Design Engineer  |72.0  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-01 00:00:00|I        |10 |Blinni    |Fenty            |bfenty9@paginegialle.it      |Female    |Assistant Media Planner|38.98 |32aab8ec-aacd-4f30-a15f-b08514c31139|2022-08-10 02:35:33.639277|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220801.csv|
|2008-01-02 00:00:00|I        |11 |Davidde   |Legier           |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|U        |11 |Tom       |Jerry            |dlegier0@mail.ru             |Agender   |Editor                 |86.5  |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-02 00:00:00|I        |12 |Panchito  |Scirman          |pscirman1@kickstarter.com    |Male      |Junior Executive       |36.18 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-02 00:00:00|I        |13 |Chic      |Ickowics         |cickowics2@booking.com       |Male      |Research Associate     |35.54 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-03 00:00:00|D        |13 |Chic      |Ickowics         |cickowics2@booking.com       |Male      |Research Associate     |100.0 |b0292cec-d239-458f-9463-172260d5bf00|2022-08-10 02:41:49.553391|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220803.csv|
|2008-01-02 00:00:00|I        |14 |Pascale   |Jedrzaszkiewicz  |pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |e54e20d6-9d9e-4877-a18e-06e809381306|2022-08-10 02:40:56.680684|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220802.csv|
|2008-01-04 00:00:00|D        |14 |Pascale   |Jedrzaszkiewicz  |pjedrzaszkiewicz3@auda.org.au|Male      |Safety Technician IV   |73.21 |e3c8e48a-47e7-472c-8088-c59d55816340|2022-08-10 02:42:15.028413|file:///Users/shaunryan/AzureDevOps/yetl-patterns/data/landing/202208/cdc_customer_20220804.csv|
+-------------------+---------+---+----------+-----------------+-----------------------------+----------+-----------------------+------+------------------------------------+--------------------------+-----------------------------------------------------------------------------------------------+
only showing top 20 rows

INFO : 2022-08-10 02:42:40,838 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer
INFO : 2022-08-10 02:42:41,103 : cdc_append : _delta_lake.py.get_audit: line(34) : Auditing database table raw.cdc_append_customer_history
INFO : 2022-08-10 02:42:41,295 : cdc_append : _delta_lake.py.get_audits: line(48) : {
    "raw.cdc_append_customer": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "MERGE",
        "operationMetrics": {
            "executionTimeMs": "2289",
            "numOutputRows": "16",
            "numSourceRows": "9",
            "numTargetChangeFilesAdded": "1",
            "numTargetFilesAdded": "1",
            "numTargetFilesRemoved": "1",
            "numTargetRowsCopied": "9",
            "numTargetRowsDeleted": "2",
            "numTargetRowsInserted": "3",
            "numTargetRowsUpdated": "4",
            "rewriteTimeMs": "1189",
            "scanTimeMs": "1095"
        },
        "operationParameters": {
            "matchedPredicates": "[{\"predicate\":\"((src.load_flag IN ('I', 'U')) AND (src.extract_date > dst.extract_date))\",\"actionType\":\"update\"},{\"predicate\":\"(src.load_flag IN ('D'))\",\"actionType\":\"delete\"}]",
            "notMatchedPredicates": "[{\"predicate\":\"(src.load_flag IN ('I', 'U'))\",\"actionType\":\"insert\"}]",
            "predicate": "(src.id = dst.id)"
        },
        "readVersion": 30,
        "timestamp": "2022-08-10 02:42:38.439000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 31
    },
    "raw.cdc_append_customer_history": {
        "clusterId": null,
        "engineInfo": "Apache-Spark/3.2.1 Delta-Lake/2.0.0",
        "isBlindAppend": false,
        "isolationLevel": "Serializable",
        "job": null,
        "notebook": null,
        "operation": "WRITE",
        "operationMetrics": {
            "numFiles": "1",
            "numOutputBytes": "4505",
            "numOutputRows": "2"
        },
        "operationParameters": {
            "mode": "Append",
            "partitionBy": "[]"
        },
        "readVersion": 41,
        "timestamp": "2022-08-10 02:42:33.777000",
        "userId": null,
        "userMetadata": null,
        "userName": null,
        "version": 42
    }
}
